(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{3237:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>X});var s=a(5155),r=a(2115),l=a(1368),n=a(7168),i=a(2355),o=a(3052),d=a(4229),c=a(3717),m=a(4416),u=a(5339),h=a(4186),x=a(4616),p=a(3999),f=a(9840),g=a(5784),j=a(2714),v=a(6645);function b(e){let{initialStartTime:t,initialDuration:a,existingAssignments:l,timePickerMode:i="assignment",onSave:o,onCancel:d}=e,[c,m]=(0,r.useState)(t),[x,p]=(0,r.useState)(a),[b,N]=(0,r.useState)(null),y=[];for(let e=0;e<24;e++)for(let t=0;t<60;t+=15){var w,T;let a=60*e+t;y.push({value:a,label:(w=e,T=t,"".concat(w%12==0?12:w%12,":").concat(T.toString().padStart(2,"0")).concat(w<12?"am":"pm"))})}let S=e=>1440-e;(0,r.useEffect)(()=>{let e=S(c),t="dropout"===i?Math.min(e,240):e;x>t&&p(t)},[c,i]);let C=(e=>{let t=S(e),a=[],s="dropout"===i?Math.min(t,240):t;for(let e=0;e<24;e++)for(let t=0;t<60;t+=15){var r,l;if(0===e&&0===t)continue;let n=60*e+t;if(n>s)break;a.push({value:n,label:(r=e,l=t,0===r?"".concat(l," minutes"):0===l?"".concat(r," ").concat(1===r?"hour":"hours"):"".concat(r," ").concat(1===r?"hour":"hours"," ").concat(l," minutes"))})}return a})(c);return(0,r.useEffect)(()=>{let e=c+x;if(e>1440){N("Shifts cannot span across days. Please adjust the duration.");return}if(l.some(t=>c<t.startTime+t.duration&&e>t.startTime)){let e="shift";"dropout"===i&&(e="dropout"),"dropin"===i&&(e="dropin"),N("This ".concat(e," overlaps with an existing ").concat(e,". Please choose a different time."))}else N(null)},[c,x,l,i]),(0,s.jsx)(f.lG,{open:!0,onOpenChange:e=>!e&&d(),children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsx)(f.c7,{children:(0,s.jsxs)(f.L3,{className:"flex items-center",children:[(()=>{switch(i){case"dropout":return(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2 text-red-500"});case"dropin":return(0,s.jsx)(h.A,{className:"h-4 w-4 mr-2 text-green-500"});default:return null}})(),(()=>{switch(i){case"dropout":return"Edit Dropout";case"dropin":return"Edit Dropin";default:return"Edit Shift"}})()]})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(j.J,{htmlFor:"start-time",className:"text-right",children:"Start Time"}),(0,s.jsxs)(g.l6,{value:c.toString(),onValueChange:e=>m(Number.parseInt(e)),children:[(0,s.jsx)(g.bq,{id:"start-time",className:"col-span-3",children:(0,s.jsx)(g.yv,{placeholder:"Select start time"})}),(0,s.jsx)(g.gC,{className:"max-h-[300px]",children:y.map(e=>(0,s.jsx)(g.eb,{value:e.value.toString(),children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(j.J,{htmlFor:"duration",className:"text-right",children:"Duration"}),(0,s.jsxs)(g.l6,{value:x.toString(),onValueChange:e=>p(Number.parseInt(e)),children:[(0,s.jsx)(g.bq,{id:"duration",className:"col-span-3",children:(0,s.jsx)(g.yv,{placeholder:"Select duration"})}),(0,s.jsx)(g.gC,{className:"max-h-[300px]",children:C.map(e=>(0,s.jsx)(g.eb,{value:e.value.toString(),children:e.label},e.value))})]})]}),b&&(0,s.jsxs)(v.Fc,{variant:"destructive",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)(v.TN,{children:b})]})]}),(0,s.jsxs)(f.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:d,children:"Cancel"}),(0,s.jsx)(n.$,{onClick:()=>{b||o(c,x)},disabled:!!b,variant:(()=>{switch(i){case"dropout":return"destructive";case"dropin":return"secondary";default:return"default"}})(),children:"Save"})]})]})})}var N=a(7777);function y(e){let{day:t,intervals:a,assignments:l,dropouts:n,isExpanded:i,formatTime:o}=e,d=(0,r.useRef)(null),c=(0,r.useRef)(null),[m,u]=(0,r.useState)(null),[h,x]=(0,r.useState)(null),[f,g]=(0,r.useState)([]),[j,v]=(0,r.useState)(new Map),b=()=>{let e=Array(96).fill(0);return l.forEach(t=>{let a=Math.floor(t.startTime/15),s=Math.ceil((t.startTime+t.duration)/15);for(let t=a;t<s&&t<96;t++)e[t]++}),n.forEach(t=>{let a=Math.floor(t.startTime/15),s=Math.ceil((t.startTime+t.duration)/15);for(let t=a;t<s&&t<96;t++)e[t]=Math.max(0,e[t]-1)}),e},N=()=>{let e=new Map;return a.forEach(t=>{let a=Math.floor(t.startTime/15),s=Math.ceil(t.endTime/15);for(let r=a;r<s&&r<96;r++)e.set(r,t.targetCount)}),e},y=e=>{let t=Math.floor(e/15);if(t<0||t>=96)return{count:0,target:0,deficit:0};let a=f[t]||0,s=j.get(t)||0,r=Math.max(0,s-a);return{count:a,target:s,deficit:r}},w=()=>{u(null),x(null)};(0,r.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&w()};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);let T=e=>{var t;let a=d.current;return a?Math.min(Math.max(0,15*Math.round(e/((null===(t=c.current)||void 0===t?void 0:t.clientWidth)||a.width)*1440/15)),1439):0},S=e=>{var t;let a=d.current;return a?e/1440*((null===(t=c.current)||void 0===t?void 0:t.clientWidth)||a.width):0};return(0,r.useEffect)(()=>{let e=b(),t=N();g(e),v(t)},[l,n,a]),(0,r.useEffect)(()=>{let e=d.current;if(!e)return;let t=e.getContext("2d");if(!t)return;t.clearRect(0,0,e.width,e.height);let s=e.width,r=e.height,l=s/96;t.strokeStyle="#e5e7eb",t.lineWidth=1;let n=Math.max(...a.map(e=>e.targetCount),10),o=r/(1.2*n);for(let e=0;e<=n;e+=5){let a=r-e*o;t.beginPath(),t.moveTo(0,a),t.lineTo(s,a),t.stroke(),t.fillStyle="#6b7280",t.font="10px sans-serif",t.fillText(e.toString(),5,a-2)}for(let e=0;e<24;e++){let a=60*e/15*l;t.beginPath(),t.moveTo(a,0),t.lineTo(a,r),t.stroke(),i&&(t.fillStyle="#6b7280",t.font="10px sans-serif",t.fillText("".concat(e,":00"),a+2,10))}t.strokeStyle="#2563eb",t.lineWidth=2,[...a].sort((e,t)=>e.startTime-t.startTime).forEach(e=>{let a=Math.floor(e.startTime/15),s=Math.ceil(e.endTime/15),n=r-e.targetCount*o;t.beginPath(),t.moveTo(a*l,n),t.lineTo(s*l,n),t.stroke()});for(let e=0;e<96;e++){let a=f[e],s=j.get(e)||0,n=e*l,i=a*o;a>0&&(a<s?t.fillStyle="rgba(239, 68, 68, 0.5)":a>s?t.fillStyle="rgba(34, 197, 94, 0.5)":t.fillStyle="rgba(59, 130, 246, 0.5)",t.fillRect(n,r-i,l,i))}let c=[],m=null;for(let e=0;e<96;e++)f[e]<(j.get(e)||0)?null===m&&(m=e):null!==m&&(c.push({start:m,end:e}),m=null);if(null!==m&&c.push({start:m,end:96}),t.strokeStyle="rgba(239, 68, 68, 0.8)",t.lineWidth=3,c.forEach(e=>{t.beginPath(),t.moveTo(e.start*l,10),t.lineTo(e.end*l,10),t.stroke(),t.fillStyle="rgba(239, 68, 68, 0.8)",t.beginPath(),t.arc(e.start*l,10,3,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e.end*l,10,3,0,2*Math.PI),t.fill()}),i){t.fillStyle="#6b7280",t.font="10px sans-serif";for(let e=0;e<24;e+=3){let a=60*e/15*l;t.fillText("".concat(e,":00"),a+2,r-5)}}},[a,f,j,i]),(0,s.jsxs)("div",{ref:c,className:(0,p.cn)("w-full h-full relative",i?"p-2":""),children:[(0,s.jsx)("canvas",{ref:d,className:"w-full h-full",width:i?960:240,height:100,onClick:e=>{e.stopPropagation();let t=d.current;if(!t)return;let a=t.getBoundingClientRect(),s=e.clientX-a.left;u(s),x(T(s))},style:{cursor:"pointer"}}),null!==m&&null!==h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed z-50 w-[2px]",style:{left:c.current?c.current.getBoundingClientRect().left+S(h):0,top:0,height:"100vh",backgroundImage:"repeating-linear-gradient(to bottom, rgba(79, 70, 229, 0.8) 0px, rgba(79, 70, 229, 0.8) 6px, transparent 6px, transparent 12px)"}}),(0,s.jsxs)("div",{className:"fixed bottom-4 bg-white px-3 py-2 rounded-md shadow-md border border-indigo-200 text-sm font-medium z-50",style:{left:c.current?c.current.getBoundingClientRect().left+S(h)+8:0,whiteSpace:"nowrap"},children:[(0,s.jsx)("div",{className:"text-indigo-700",children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(h)}),(()=>{let{count:e,target:t,deficit:a}=y(h);return(0,s.jsxs)("div",{className:"text-xs mt-1 flex items-center gap-2",children:[(0,s.jsxs)("span",{children:["Resources:"," ",(0,s.jsxs)("span",{className:"font-semibold",children:[e,"/",t]})]}),a>0&&(0,s.jsxs)("span",{className:"text-red-600 font-semibold",children:["Deficit: ",a]})]})})()]})]})]})}let w=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,p.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});function T(e){let{day:t,intervals:a,onSave:l,onCancel:i,formatTime:o}=e,[d,c]=(0,r.useState)(a),u=[];for(let e=0;e<24;e++)for(let t=0;t<60;t+=15){let a=60*e+t;u.push({value:a,label:o(a)})}let h=e=>{c(d.filter(t=>t.id!==e))},p=(e,t,a)=>{c(d.map(s=>s.id===e?{...s,[t]:a}:s))};return(0,s.jsx)(f.lG,{open:!0,onOpenChange:e=>!e&&i(),children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-[600px]",children:[(0,s.jsx)(f.c7,{children:(0,s.jsx)(f.L3,{children:"Edit Resource Targets"})}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Time Intervals"}),(0,s.jsxs)(n.$,{size:"sm",onClick:()=>{let e=540,t=1020,a=!0;for(;a;)(a=d.some(a=>e>=a.startTime&&e<a.endTime||t>a.startTime&&t<=a.endTime||e<=a.startTime&&t>=a.endTime))&&(e+=60,(t+=60)>=1440&&(e=0,t=480));c([...d,{id:"interval-".concat(Date.now()),startTime:e,endTime:t,targetCount:5}])},children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-1"})," Add Interval"]})]}),0===d.length?(0,s.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:'No resource targets defined. Click "Add Interval" to create one.'}):(0,s.jsx)("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:d.map(e=>(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center border p-2 rounded-md",children:[(0,s.jsxs)("div",{className:"col-span-4",children:[(0,s.jsx)(j.J,{htmlFor:"start-".concat(e.id),className:"text-xs mb-1 block",children:"Start Time"}),(0,s.jsxs)(g.l6,{value:e.startTime.toString(),onValueChange:t=>p(e.id,"startTime",Number(t)),children:[(0,s.jsx)(g.bq,{id:"start-".concat(e.id),className:"h-8",children:(0,s.jsx)(g.yv,{placeholder:"Start time"})}),(0,s.jsx)(g.gC,{className:"max-h-[300px]",children:u.map(t=>(0,s.jsx)(g.eb,{value:t.value.toString(),children:t.label},"start-".concat(e.id,"-").concat(t.value)))})]})]}),(0,s.jsxs)("div",{className:"col-span-4",children:[(0,s.jsx)(j.J,{htmlFor:"end-".concat(e.id),className:"text-xs mb-1 block",children:"End Time"}),(0,s.jsxs)(g.l6,{value:e.endTime.toString(),onValueChange:t=>p(e.id,"endTime",Number(t)),children:[(0,s.jsx)(g.bq,{id:"end-".concat(e.id),className:"h-8",children:(0,s.jsx)(g.yv,{placeholder:"End time"})}),(0,s.jsx)(g.gC,{className:"max-h-[300px]",children:u.map(t=>(0,s.jsx)(g.eb,{value:t.value.toString(),children:t.label},"end-".concat(e.id,"-").concat(t.value)))})]})]}),(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsx)(j.J,{htmlFor:"count-".concat(e.id),className:"text-xs mb-1 block",children:"Target Count"}),(0,s.jsx)(w,{id:"count-".concat(e.id),type:"number",value:e.targetCount,onChange:t=>p(e.id,"targetCount",Number(t.target.value)),min:"0",className:"h-8"})]}),(0,s.jsx)("div",{className:"col-span-1 flex items-end justify-end h-full",children:(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>h(e.id),className:"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})})]},e.id))})]}),(0,s.jsxs)(f.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:i,children:"Cancel"}),(0,s.jsx)(n.$,{onClick:()=>{l(t,[...d].sort((e,t)=>e.startTime-t.startTime))},children:"Save"})]})]})})}w.displayName="Input";var S=a(714),C=a(3008);let k={North:"bg-blue-50",South:"bg-green-50",East:"bg-amber-50",West:"bg-purple-50",Central:"bg-rose-50"};function A(e){let{employees:t,assignments:a,dropouts:l,unplannedTimes:f,resourceIntervals:g,onAssignmentChange:j,onAssignmentDelete:v,onAssignmentAdd:w,onDropoutChange:A,onDropoutDelete:I,onDropoutAdd:M,onUnplannedTimeChange:E,onUnplannedTimeDelete:D,onUnplannedTimeAdd:P,onResourceIntervalsChange:z,weekStartDate:O}=e,[$,_]=(0,r.useState)(null),[R,F]=(0,r.useState)(!1),[L,W]=(0,r.useState)(null),[J,U]=(0,r.useState)(null),[B,q]=(0,r.useState)(null),[G,V]=(0,r.useState)(null),[Y,X]=(0,r.useState)(null),[Z,K]=(0,r.useState)(null),[H,Q]=(0,r.useState)(null),[ee,et]=(0,r.useState)({}),[ea,es]=(0,r.useState)([]),[er,el]=(0,r.useState)(null),[en,ei]=(0,r.useState)(null),[eo,ed]=(0,r.useState)(null),[ec,em]=(0,r.useState)(!1),[eu,eh]=(0,r.useState)(0),[ex,ep]=(0,r.useState)("assignment"),ef=(0,r.useRef)([]),eg=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map((e,t)=>{let a=(0,S.f)(O,t);return{name:e,date:(0,C.GP)(a,"MMM d"),fullDate:a}}),ej=e=>{let t=Math.floor(e/60);return"".concat(t%12==0?12:t%12,":").concat((e%60).toString().padStart(2,"0")).concat(t<12?"am":"pm")},ev=e=>a.filter(t=>t.employeeId===e),eb=e=>l.filter(t=>t.employeeId===e),eN=e=>f.filter(t=>t.employeeId===e),ey=e=>a.filter(t=>t.day===e),ew=e=>l.filter(t=>t.day===e),eT=e=>g.filter(t=>t.day===e);(0,r.useEffect)(()=>{let e={};t.forEach(t=>{let a=$===t.id?20:16;e[t.id]=a}),et(e)},[t,$]);let eS=e=>{$===e?_(null):_(e)},eC=e=>{$===e.employeeId&&(es(a.filter(t=>t.employeeId===e.employeeId&&t.day===e.day&&t.id!==e.id).map(e=>({startTime:e.startTime,duration:e.duration}))),W(e),U(null),q(null),ep("assignment"),F(!0))},ek=e=>{$===e.employeeId&&(es(l.filter(t=>t.employeeId===e.employeeId&&t.day===e.day&&t.id!==e.id).map(e=>({startTime:e.startTime,duration:e.duration}))),U(e),W(null),q(null),ep("dropout"),F(!0))},eA=e=>{$===e.employeeId&&(es(f.filter(t=>t.employeeId===e.employeeId&&t.day===e.day&&t.id!==e.id).map(e=>({startTime:e.startTime,duration:e.duration}))),q(e),W(null),U(null),ep("dropin"),F(!0))},eI=(e,t)=>{$===e&&(es(a.filter(a=>a.employeeId===e&&a.day===t).map(e=>({startTime:e.startTime,duration:e.duration}))),V({employeeId:e,day:t,startTime:540,duration:240}),X(null),K(null),ep("assignment"),F(!0))},eM=(e,t)=>{$===e&&(es(l.filter(a=>a.employeeId===e&&a.day===t).map(e=>({startTime:e.startTime,duration:e.duration}))),X({employeeId:e,day:t,startTime:600,duration:60}),V(null),K(null),ep("dropout"),F(!0))},eE=(e,t)=>{$===e&&(es(f.filter(a=>a.employeeId===e&&a.day===t).map(e=>({startTime:e.startTime,duration:e.duration}))),K({employeeId:e,day:t,startTime:570,duration:240}),V(null),X(null),ep("dropin"),F(!0))},eD=e=>{H===e?Q(null):Q(e)},eP=e=>{eh(e),em(!0)},ez={};t.forEach(e=>{ez[e.location]||(ez[e.location]=[]),ez[e.location].push(e)});let eO=Object.keys(ez).sort(),e$=(e,t)=>{let a=4*(ee[e]||16);return t&&$===e?"".concat(a+60,"px"):"".concat(a,"px")};return(0,s.jsx)(N.Bc,{delayDuration:200,children:(0,s.jsxs)("div",{className:"border rounded-lg overflow-auto relative",children:[(0,s.jsxs)("div",{className:"grid min-w-[1000px]",style:{gridTemplateColumns:(()=>{if(null===H)return"200px repeat(7, 1fr)";let e=["200px"];for(let t=0;t<7;t++)t===H?e.push("8fr"):e.push("0.5fr");return e.join(" ")})()},children:[(0,s.jsx)("div",{className:"bg-muted p-2 font-medium border-b border-r sticky left-0 z-40 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",style:{width:"200px"},children:"Operator"}),eg.map((e,t)=>(0,s.jsx)("div",{className:(0,p.cn)("bg-muted p-2 font-medium text-center border-b border-r cursor-pointer transition-all",H===t?"bg-muted/80":""),onClick:()=>eD(t),ref:e=>ef.current[t]=e,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[H===t&&(0,s.jsx)(i.A,{className:"h-4 w-4"}),e.name,H===t&&(0,s.jsx)(o.A,{className:"h-4 w-4"})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.date})]})},e.name)),eO.map(e=>{let t=k[e]||"bg-gray-50";return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)("div",{className:"col-span-8 bg-muted/50 p-2 font-medium border-b sticky left-0 z-30",children:[e," Location"]}),ez[e].map(e=>{let a=ev(e.id),l=eb(e.id),i=eN(e.id);return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)("div",{className:(0,p.cn)("p-2 border-b border-r flex items-center justify-between sticky left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",t),style:{height:e$(e.id,!1)},children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>eS(e.id),className:"h-6 w-6",children:$===e.id?(0,s.jsx)(d.A,{className:"h-4 w-4"}):(0,s.jsx)(c.A,{className:"h-4 w-4"})})]}),eg.map((r,o)=>{let d=a.filter(e=>e.day===o).sort((e,t)=>e.startTime-t.startTime),c=l.filter(e=>e.day===o).sort((e,t)=>e.startTime-t.startTime),f=i.filter(e=>e.day===o).sort((e,t)=>e.startTime-t.startTime),g=H===o;return(0,s.jsxs)("div",{className:(0,p.cn)("border-b border-r relative transition-all",t,g?"cursor-pointer overflow-y-auto":"overflow-hidden",g&&$===e.id?"pb-16":""),style:{height:e$(e.id,g)},onClick:()=>{g||eD(o)},children:[(0,s.jsxs)("div",{className:"h-full relative pt-2 px-2",children:[d.map(t=>{let a=t.startTime/1440*100,r=t.duration/1440*100,l=t.startTime+t.duration;return t.id,(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("absolute flex items-center justify-center text-[10px] font-medium text-white cursor-pointer transition-all",$===e.id?"bg-blue-600":"bg-blue-500",$===e.id?"hover:opacity-80":""),style:{left:"".concat(a,"%"),width:"".concat(r,"%"),top:"60%",transform:"translateY(-50%)",height:"20px",zIndex:"10",minWidth:"10px",maxWidth:"".concat(100-a,"%")},onClick:e=>{e.stopPropagation(),eC(t)},onMouseEnter:()=>el(t.id),onMouseLeave:()=>el(null),children:$===e.id&&(0,s.jsx)("button",{className:"absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5",onClick:e=>{e.stopPropagation(),v(t.id)},children:(0,s.jsx)(m.A,{className:"h-3 w-3"})})})}),(0,s.jsxs)(N.ZI,{className:"bg-blue-100/90 border-blue-200 text-blue-800",children:[ej(t.startTime),"-",ej(l)]})]},t.id)}),c.map(t=>{let a=t.startTime/1440*100,r=t.duration/1440*100,l=t.startTime+t.duration;return t.id,(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("absolute flex items-center justify-center text-[10px] font-medium text-white cursor-pointer transition-all",$===e.id?"bg-red-400":"bg-red-300",$===e.id?"hover:opacity-80":""),style:{left:"".concat(a,"%"),width:"".concat(r,"%"),top:"40%",transform:"translateY(-50%)",height:"14px",zIndex:"20",minWidth:"8px",maxWidth:"".concat(100-a,"%")},onClick:e=>{e.stopPropagation(),ek(t)},onMouseEnter:()=>ei(t.id),onMouseLeave:()=>ei(null),children:$===e.id&&(0,s.jsx)("button",{className:"absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5 z-30",onClick:e=>{e.stopPropagation(),I(t.id)},children:(0,s.jsx)(m.A,{className:"h-3 w-3"})})})}),(0,s.jsx)(N.ZI,{className:"bg-red-100/90 border-red-200 text-red-800",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(u.A,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[ej(t.startTime),"-",ej(l)]})]})})]},t.id)}),f.map(t=>{let a=t.startTime/1440*100,r=t.duration/1440*100,l=t.startTime+t.duration;return t.id,(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("absolute flex items-center justify-center text-[10px] font-medium text-white cursor-pointer transition-all",$===e.id?"bg-green-500":"bg-green-400",$===e.id?"hover:opacity-80":""),style:{left:"".concat(a,"%"),width:"".concat(r,"%"),top:"80%",transform:"translateY(-50%)",height:"14px",zIndex:"15",minWidth:"8px",maxWidth:"".concat(100-a,"%")},onClick:e=>{e.stopPropagation(),eA(t)},onMouseEnter:()=>ed(t.id),onMouseLeave:()=>ed(null),children:$===e.id&&(0,s.jsx)("button",{className:"absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5 z-30",onClick:e=>{e.stopPropagation(),D(t.id)},children:(0,s.jsx)(m.A,{className:"h-3 w-3"})})})}),(0,s.jsx)(N.ZI,{className:"bg-green-100/90 border-green-200 text-green-800",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(h.A,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[ej(t.startTime),"-",ej(l)]})]})})]},t.id)})]}),$===e.id&&g&&(0,s.jsxs)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-2 mt-4 border-t pt-3 bg-white/50",children:[(0,s.jsxs)(n.$,{variant:"outline",size:"sm",className:"h-8 text-xs",onClick:t=>{t.stopPropagation(),eI(e.id,o)},children:[(0,s.jsx)(x.A,{className:"h-3 w-3 mr-1"})," Add Shift"]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",className:"h-8 text-xs text-red-500 border-red-200 hover:bg-red-50 hover:text-red-600",onClick:t=>{t.stopPropagation(),eM(e.id,o)},children:[(0,s.jsx)(u.A,{className:"h-3 w-3 mr-1"})," Add Dropout"]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",className:"h-8 text-xs text-green-500 border-green-200 hover:bg-green-50 hover:text-green-600",onClick:t=>{t.stopPropagation(),eE(e.id,o)},children:[(0,s.jsx)(h.A,{className:"h-3 w-3 mr-1"})," Add Dropin"]})]})]},"".concat(e.id,"-").concat(o))})]},e.id)})]},e)}),(0,s.jsx)("div",{className:"bg-slate-100 p-2 border-b border-r flex items-center justify-between sticky left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:(0,s.jsx)("span",{className:"font-medium",children:"Resource Chart"})}),eg.map((e,t)=>{let a=ey(t),r=ew(t),l=eT(t),i=H===t,o=a.map(e=>({startTime:e.startTime,duration:e.duration})),d=r.map(e=>({startTime:e.startTime,duration:e.duration}));return(0,s.jsxs)("div",{className:"bg-slate-100 border-b border-r relative",style:{height:"120px"},children:[(0,s.jsx)("div",{className:"absolute inset-0",children:(0,s.jsx)(y,{day:t,intervals:l,assignments:o,dropouts:d,isExpanded:i,formatTime:ej})}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",className:"absolute bottom-1 right-1 h-6 w-6 bg-white/80 hover:bg-white z-10",onClick:e=>{e.stopPropagation(),eP(t)},children:(0,s.jsx)(c.A,{className:"h-3 w-3"})})]},"resource-".concat(t))})]}),R&&(0,s.jsx)(b,{initialStartTime:(null==L?void 0:L.startTime)||(null==J?void 0:J.startTime)||(null==B?void 0:B.startTime)||(null==G?void 0:G.startTime)||(null==Y?void 0:Y.startTime)||(null==Z?void 0:Z.startTime)||540,initialDuration:(null==L?void 0:L.duration)||(null==J?void 0:J.duration)||(null==B?void 0:B.duration)||(null==G?void 0:G.duration)||(null==Y?void 0:Y.duration)||(null==Z?void 0:Z.duration)||("dropout"===ex?60:240),existingAssignments:ea,timePickerMode:ex,onSave:(e,t)=>{"dropout"===ex?J?A({...J,startTime:e,duration:t}):Y&&M({...Y,startTime:e,duration:t}):"dropin"===ex?B?E({...B,startTime:e,duration:t}):Z&&P({...Z,startTime:e,duration:t}):L?j({...L,startTime:e,duration:t}):G&&w({...G,startTime:e,duration:t}),F(!1),W(null),U(null),q(null),V(null),X(null),K(null),es([])},onCancel:()=>{F(!1),W(null),U(null),q(null),V(null),X(null),K(null),es([])}}),ec&&(0,s.jsx)(T,{day:eu,intervals:eT(eu),onSave:(e,t)=>{z([...g.filter(t=>t.day!==e),...t.map(t=>({...t,day:e}))]),em(!1)},onCancel:()=>{em(!1)},formatTime:ej})]})})}var I=a(1665),M=a(9074),E=a(5525),D=a(7580),P=a(4423),z=a(2794),O=a(4964),$=a(2525);async function _(e,t){try{let a=await fetch("".concat("http://10.0.50.84:8000/ccm/shift").concat(e),{...t,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")),...null==t?void 0:t.headers}});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}catch(e){return{status:{success:!1,message:e instanceof Error?e.message:"API request failed",timestamp:new Date().toISOString()},data:null}}}let R={operators:{list:async e=>_("/operators/profiles?".concat(new URLSearchParams(Object.entries(e).filter(e=>{let[,t]=e;return null!=t})).toString())),create:async e=>_("/operators/profiles",{method:"POST",body:JSON.stringify(e)}),get:async e=>_("/operators/profiles/".concat(e)),update:async(e,t)=>_("/operators/profiles/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>_("/operators/profiles/".concat(e),{method:"DELETE"}),getByUserId:async e=>_("/operators/profiles/user/".concat(e))}};function F(e){let{open:t,onOpenChange:a,operators:i,onOperatorsChange:o}=e,[d,c]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[p,b]=(0,r.useState)(""),[N,y]=(0,r.useState)(""),[T,S]=(0,r.useState)("operators"),[C,k]=(0,r.useState)(null),A=Array.from(new Set(i.map(e=>e.location))).sort(),I=async()=>{if(""===d.trim()||""===m)return;let e={id:(0,l.A)(),userId:(0,l.A)(),name:d.trim(),location:m,timezoneId:"UTC",region:p,isActive:!0},t=await R.operators.create(e);t.status.success?(o([...i,e]),c(""),b("")):alert(t.status.message)},M=()=>{if(""!==N.trim()){if(A.includes(N.trim())){k("Location already exists");return}o([...i,{id:(0,l.A)(),name:"".concat(N.trim()," Manager"),location:N.trim(),region:"Default Region"}]),h(N.trim()),y(""),k(null),S("operators")}},E=async e=>{let t=await R.operators.delete(e);alert(t.status.message),t.status.success&&o(i.filter(t=>t.id!==e))},D=e=>{i.filter(t=>t.location===e).length>0&&o(i.filter(t=>t.location!==e)),m===e&&h("")},P=(e,t)=>{"Enter"===e.key&&(e.preventDefault(),t())},z={};return i.forEach(e=>{z[e.location]||(z[e.location]=[]),z[e.location].push(e)}),(0,s.jsx)(f.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsx)(f.c7,{children:(0,s.jsx)(f.L3,{children:"Manage Operators"})}),(0,s.jsxs)(O.tU,{value:T,onValueChange:S,className:"w-full",children:[(0,s.jsxs)(O.j7,{className:"grid grid-cols-2 mb-4",children:[(0,s.jsx)(O.Xi,{value:"operators",children:"Operators"}),(0,s.jsx)(O.Xi,{value:"locations",children:"Locations"})]}),(0,s.jsxs)(O.av,{value:"operators",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(j.J,{htmlFor:"operator-name",className:"text-xs",children:"Name"}),(0,s.jsx)(w,{id:"operator-name",value:d,onChange:e=>c(e.target.value),onKeyDown:e=>P(e,I),placeholder:"Enter name",className:"h-8"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(j.J,{htmlFor:"operator-location",className:"text-xs",children:"Location"}),(0,s.jsxs)(g.l6,{value:m,onValueChange:h,children:[(0,s.jsx)(g.bq,{id:"operator-location",className:"h-8",children:(0,s.jsx)(g.yv,{placeholder:"Select location"})}),(0,s.jsx)(g.gC,{children:A.map(e=>(0,s.jsx)(g.eb,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(j.J,{htmlFor:"operator-region",className:"text-xs",children:"Region"}),(0,s.jsx)(w,{id:"operator-region",value:p,onChange:e=>b(e.target.value),onKeyDown:e=>P(e,I),placeholder:"Enter region",className:"h-8"})]}),(0,s.jsxs)(n.$,{onClick:I,size:"sm",disabled:""===d.trim()||""===m,children:[(0,s.jsx)(x.A,{className:"h-3 w-3 mr-1"})," Add"]})]}),(0,s.jsx)("div",{className:"border rounded-md max-h-[250px] overflow-y-auto",children:0===A.length?(0,s.jsx)("div",{className:"p-3 text-center text-muted-foreground text-sm",children:"No locations defined. Add a location first."}):0===Object.keys(z).length?(0,s.jsx)("div",{className:"p-3 text-center text-muted-foreground text-sm",children:"No operators added yet."}):A.map(e=>{let t=z[e]||[];return 0===t.length?null:(0,s.jsxs)("div",{className:"border-b last:border-b-0",children:[(0,s.jsxs)("div",{className:"bg-muted px-3 py-1 font-medium text-sm",children:[e," Location"]}),t.map(e=>(0,s.jsxs)("div",{className:"px-3 py-2 flex justify-between items-center border-t",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm",children:e.name}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.region})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>E(e.id),className:"h-6 w-6 text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)($.A,{className:"h-3 w-3"})})]},e.id))]},e)})})]}),(0,s.jsxs)(O.av,{value:"locations",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(j.J,{htmlFor:"location-name",className:"text-xs",children:"Location Name"}),(0,s.jsx)(w,{id:"location-name",value:N,onChange:e=>{y(e.target.value),k(null)},onKeyDown:e=>P(e,M),placeholder:"Enter location name",className:"h-8"})]}),(0,s.jsxs)(n.$,{onClick:M,size:"sm",disabled:""===N.trim(),children:[(0,s.jsx)(x.A,{className:"h-3 w-3 mr-1"})," Add"]})]}),C&&(0,s.jsxs)(v.Fc,{variant:"destructive",className:"py-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)(v.TN,{children:C})]}),(0,s.jsx)("div",{className:"border rounded-md max-h-[250px] overflow-y-auto",children:0===A.length?(0,s.jsx)("div",{className:"p-3 text-center text-muted-foreground text-sm",children:"No locations defined yet."}):(0,s.jsx)("div",{className:"divide-y",children:A.map(e=>(0,s.jsxs)("div",{className:"px-3 py-2 text-sm flex justify-between items-center",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>D(e),className:"h-6 w-6 text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)($.A,{className:"h-3 w-3"})})]},e))})})]})]}),(0,s.jsx)(f.Es,{children:(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>a(!1),children:"Close"})})]})})}var L=a(5118);function W(e){let{currentWeekStart:t,onWeekSelect:a,resourceIntervals:l,assignments:n,dropouts:i}=e,[o,d]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=new Date(new Date().getFullYear(),0,1),t=(0,P.k)(e,{weekStartsOn:1}),a=[];for(let e=0;e<52;e++){let s=(0,L.J)(t,e),r=(0,z.$)(s,{weekStartsOn:1}),l=c(s,r);a.push({start:s,end:r,hasDeficit:l})}d(a)},[l,n,i]);let c=(e,t)=>{for(let e=0;e<7;e++)if(m(e))return!0;return!1},m=e=>{let t=l.filter(t=>t.day===e);if(0===t.length)return!1;let a=n.filter(t=>t.day===e),s=i.filter(t=>t.day===e);for(let e=0;e<1440;e+=15)if(u(a,s,e)<h(t,e))return!0;return!1},u=(e,t,a)=>Math.max(0,e.filter(e=>a>=e.startTime&&a<e.startTime+e.duration).length-t.filter(e=>a>=e.startTime&&a<e.startTime+e.duration).length),h=(e,t)=>{let a=e.find(e=>t>=e.startTime&&t<e.endTime);return a?a.targetCount:0},x=e=>{let a=(0,P.k)(t,{weekStartsOn:1});return e.getTime()===a.getTime()};return(0,s.jsx)(N.Bc,{children:(0,s.jsxs)("div",{className:"mb-4 bg-white p-3 rounded-lg shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Year Overview"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date().getFullYear()})]}),(0,s.jsx)("div",{className:"flex overflow-x-auto pb-2",children:o.map((e,t)=>(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("w-5 h-8 mx-0.5 rounded cursor-pointer transition-all flex-shrink-0",e.hasDeficit?"bg-red-400 hover:bg-red-500":"bg-blue-400 hover:bg-blue-500",x(e.start)&&"ring-2 ring-offset-2 ring-black"),onClick:()=>a(e.start)})}),(0,s.jsxs)(N.ZI,{children:[(0,s.jsxs)("p",{className:"text-xs",children:[(0,C.GP)(e.start,"MMM d")," - ",(0,C.GP)(e.end,"MMM d")]}),(0,s.jsx)("p",{className:"text-xs font-medium",children:e.hasDeficit?"Resource deficit":"No resource deficit"})]})]},t))})]})})}var J=a(6874),U=a.n(J);let B=[],q=[],G=[],V=[],Y=[];function X(){let[e,t]=(0,r.useState)(B),a=async()=>{t((await R.operators.list({activeOnly:!0})).data.items.map(e=>({id:e.id,profileId:e.userId,name:e.username,location:e.region,region:e.region})))};(0,r.useEffect)(()=>{a()},[]);let[i,o]=(0,r.useState)(q),[d,c]=(0,r.useState)(G),[m,u]=(0,r.useState)(V),[h,x]=(0,r.useState)(Y),[p,f]=(0,r.useState)((0,P.k)(new Date,{weekStartsOn:1})),[g,j]=(0,r.useState)(!1),v=(e,t)=>{f(e),console.log("Week changed: ".concat(e.toDateString()," to ").concat(t.toDateString()))};return(0,s.jsxs)("div",{className:"container mx-auto py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Shift Guard Schedule v60"}),(0,s.jsx)(U(),{href:"/my-dropouts",children:(0,s.jsxs)(n.$,{variant:"secondary",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)(M.A,{className:"h-4 w-4"}),"My Dropout Requests"]})}),(0,s.jsx)(U(),{href:"/admin/dropout-requests",children:(0,s.jsxs)(n.$,{variant:"outline",size:"sm",className:"flex items-center gap-2 border-purple-200 text-purple-700 hover:bg-purple-50",children:[(0,s.jsx)(E.A,{className:"h-4 w-4"}),"Admin Dropout Management"]})})]}),(0,s.jsxs)(n.$,{onClick:()=>j(!0),className:"flex items-center gap-2",children:[(0,s.jsx)(D.A,{className:"h-4 w-4"}),"Manage Operators"]})]}),(0,s.jsx)(W,{currentWeekStart:p,onWeekSelect:e=>{f(e);let t=(0,z.$)(e,{weekStartsOn:1});v(e,t)},resourceIntervals:h,assignments:i,dropouts:d}),(0,s.jsx)(I.I,{currentDate:p,onWeekChange:v}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)(A,{employees:e,assignments:i,dropouts:d,unplannedTimes:m,resourceIntervals:h,onAssignmentChange:e=>{o(i.map(t=>t.id===e.id?e:t))},onAssignmentDelete:e=>{o(i.filter(t=>t.id!==e))},onAssignmentAdd:e=>{o([...i,{id:(0,l.A)(),employeeId:e.employeeId||"",day:e.day||0,startTime:e.startTime||0,duration:e.duration||0}])},onDropoutChange:e=>{c(d.map(t=>t.id===e.id?e:t))},onDropoutDelete:e=>{c(d.filter(t=>t.id!==e))},onDropoutAdd:e=>{c([...d,{id:(0,l.A)(),employeeId:e.employeeId||"",day:e.day||0,startTime:e.startTime||0,duration:e.duration||0}])},onUnplannedTimeChange:e=>{u(m.map(t=>t.id===e.id?e:t))},onUnplannedTimeDelete:e=>{u(m.filter(t=>t.id!==e))},onUnplannedTimeAdd:e=>{u([...m,{id:(0,l.A)(),employeeId:e.employeeId||"",day:e.day||0,startTime:e.startTime||0,duration:e.duration||0}])},onResourceIntervalsChange:e=>{x(e)},weekStartDate:p})}),(0,s.jsx)(F,{open:g,onOpenChange:j,operators:e,onOperatorsChange:a=>{if(a.length<e.length){let e=new Set(a.map(e=>e.id));o(i.filter(t=>e.has(t.employeeId))),c(d.filter(t=>e.has(t.employeeId))),u(m.filter(t=>e.has(t.employeeId)))}t(a)}})]})}},4964:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>i});var s=a(5155),r=a(2115),l=a(64),n=a(3999);let i=l.bL,o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=l.B8.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});d.displayName=l.l9.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});c.displayName=l.UC.displayName},8206:(e,t,a)=>{Promise.resolve().then(a.bind(a,3237))}},e=>{var t=t=>e(e.s=t);e.O(0,[653,965,318,902,441,684,358],()=>t(8206)),_N_E=e.O()}]);